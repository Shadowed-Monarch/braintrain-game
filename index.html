<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BrainTrain Game</title>
    <style>
        @property --accent { syntax: '<color>'; initial-value: #ff0000; inherits: true; }
        :root[data-theme="dark"] { --bg: #050505; --card: #111; --text: #ffffff; --subtext: #666; --border: #333; }
        :root[data-theme="light"] { --bg: #f5f5f5; --card: #ffffff; --text: #000000; --subtext: #555; --border: #ddd; }
        @keyframes rainbow-loop { 0% { --accent: #ff0000; } 20% { --accent: #ffcc00; } 40% { --accent: #00ff00; } 60% { --accent: #00ffff; } 80% { --accent: #9900ff; } 100% { --accent: #ff0000; } }
        .rainbow-active { animation: rainbow-loop 5s infinite linear !important; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; transition: background 0.3s; }
        header { width: 100%; max-width: 1000px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .logo { font-size: 1.8rem; font-weight: 800; letter-spacing: 2px; }
        .logo span { color: var(--accent); }
        
        .progress-container { width: 100%; max-width: 400px; margin-bottom: 30px; text-align: center; }
        .progress-bar { width: 100%; height: 10px; background: var(--border); border-radius: 5px; margin: 10px 0; overflow: hidden; }
        #rank-progress { height: 100%; background: var(--accent); width: 0%; transition: 0.5s; }

        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; width: 100%; max-width: 1000px; }
        .game-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 30px; text-align: center; transition: 0.3s; text-decoration: none; color: inherit; position: relative; }
        .game-card:hover { border-color: var(--accent); transform: translateY(-5px); }
        .game-card img { width: 80px; height: 80px; margin-bottom: 15px; }
        .lvl-tag { position: absolute; top: 15px; right: 15px; font-size: 0.8rem; font-weight: bold; color: var(--accent); }

        .shop-btn { margin-top: 40px; padding: 12px 30px; font-weight: bold; background: var(--card); color: var(--text); border: 2px solid var(--accent); cursor: pointer; border-radius: 10px; }
        .shop-section { display: none; margin-top: 20px; width: 100%; max-width: 1000px; }
        .shop-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 15px; }
        .skin-item { aspect-ratio: 1; border-radius: 15px; border: 2px solid var(--border); cursor: pointer; display: flex; align-items: center; justify-content: center; flex-direction: column; font-size: 0.7rem; background: var(--card); }
        .skin-item.active { border-color: var(--accent); }
        .swatch { width: 30px; height: 30px; border-radius: 50%; margin-bottom: 5px; }
    </style>
</head>
<body>
    <header>
        <div class="logo">BRAIN<span>TRAIN</span></div>
        <div style="display: flex; gap: 10px; align-items: center;">
            <button onclick="toggleMode()" style="background:none; border:1px solid var(--border); color:var(--text); padding:5px 10px; border-radius:5px; cursor:pointer;">THEME</button>
            <div style="color: #ff77ff; font-weight: bold;">ðŸ§  <span id="user-brains">0</span></div>
        </div>
    </header>

    <div class="progress-container">
        <div>RANK: <span id="rank-name" style="font-weight:bold; color:var(--accent)">STUDENT</span></div>
        <div class="progress-bar"><div id="rank-progress"></div></div>
        <div id="next-rank-info" style="color:var(--subtext); font-size:0.8rem;"></div>
    </div>

    <div class="grid">
        <a href="math.html" class="game-card">
            <div class="lvl-tag">LVL <span id="math-lvl">1</span></div>
            <img src="https://cdn-icons-png.flaticon.com/512/3771/3771278.png" alt="Math">
            <h3>Maths Train</h3>
            <p>Solve equations before the bubbles hit the floor.</p>
        </a>

        <a href="grammar.html" class="game-card">
            <div class="lvl-tag">LVL <span id="grammar-lvl">1</span></div>
            <img src="https://cdn-icons-png.flaticon.com/512/3850/3850285.png" alt="Grammar">
            <h3>Grammar Train</h3>
            <p>Type the opposite of words as they fall.</p>
        </a>

        <a href="dots.html" class="game-card">
            <div class="lvl-tag">LVL <span id="dots-lvl">1</span></div>
            <img src="https://cdn-icons-png.flaticon.com/512/3306/3306631.png" alt="Dots">
            <h3>Dots Reflex</h3>
            <p>Tap the numbers in order as fast as you can.</p>
        </a>

        <a href="memory.html" class="game-card">
            <div class="lvl-tag">LVL <span id="memory-lvl">1</span></div>
            <img src="https://cdn-icons-png.flaticon.com/512/2491/2491211.png" alt="Memory">
            <h3>Memory Matrix</h3>
            <p>Remember the glowing blocks and tap them.</p>
        </a>
    </div>

    <button class="shop-btn" onclick="toggleShop()">OPEN SKIN SHOP</button>

    <div class="shop-section" id="shop-area">
        <div class="shop-grid" id="skin-grid"></div>
    </div>

    <script>
        const skins = [
            { id: 'red', color: '#ff0000', cost: 0 },
            { id: 'blue', color: '#0088ff', cost: 500 },
            { id: 'green', color: '#00ff00', cost: 1000 },
            { id: 'yellow', color: '#ffcc00', cost: 1500 },
            { id: 'cyan', color: '#00ffff', cost: 2000 },
            { id: 'pink', color: '#ff00ff', cost: 2500 },
            { id: 'purple', color: '#9900ff', cost: 3000 },
            { id: 'orange', color: '#ff6600', cost: 3500 },
            { id: 'gold', color: '#ffd700', cost: 5000 },
            { id: 'rainbow', color: 'linear-gradient(45deg, red, orange, yellow, green, blue, purple)', cost: 10000 }
        ];

        function toggleShop() {
            const shop = document.getElementById('shop-area');
            shop.style.display = shop.style.display === 'block' ? 'none' : 'block';
        }

        function updateUI() {
            const brains = parseInt(localStorage.getItem('bt_coins')) || 0;
            document.getElementById('user-brains').innerText = brains;
            
            const mLvl = parseInt(localStorage.getItem('bt_unlocked_math')) || 1;
            const gLvl = parseInt(localStorage.getItem('bt_unlocked_grammar')) || 1;
            const dLvl = parseInt(localStorage.getItem('bt_unlocked_dots')) || 1;
            const memLvl = parseInt(localStorage.getItem('bt_unlocked_memory')) || 1;

            document.getElementById('math-lvl').innerText = mLvl;
            document.getElementById('grammar-lvl').innerText = gLvl;
            document.getElementById('dots-lvl').innerText = dLvl;
            document.getElementById('memory-lvl').innerText = memLvl;

            const totalLvl = mLvl + gLvl + dLvl + memLvl - 4;
            updateRank(totalLvl);

            const currentSkin = localStorage.getItem('bt_current_skin') || 'red';
            if(currentSkin === 'rainbow') {
                document.body.classList.add('rainbow-active');
            } else {
                document.body.classList.remove('rainbow-active');
                const colors = { red:'#ff0000', blue:'#0088ff', green:'#00ff00', yellow:'#ffcc00', cyan:'#00ffff', pink:'#ff00ff', purple:'#9900ff', orange:'#ff6600', gold:'#ffd700' };
                document.documentElement.style.setProperty('--accent', colors[currentSkin] || '#ff0000');
            }
            renderShop();
        }

        function updateRank(lvls) {
            const ranks = [
                { name: "STUDENT", min: 0, max: 10 },
                { name: "SCHOLAR", min: 10, max: 30 },
                { name: "GENIUS", min: 30, max: 60 },
                { name: "MASTER", min: 60, max: 100 },
                { name: "OVERLORD", min: 100, max: 999 }
            ];
            let currentRank = ranks[0];
            for (let r of ranks) { if (lvls >= r.min) currentRank = r; }
            
            document.getElementById('rank-name').innerText = currentRank.name;
            let progress = ((lvls - currentRank.min) / (currentRank.max - currentRank.min)) * 100;
            document.getElementById('rank-progress').style.width = Math.min(progress, 100) + "%";
            document.getElementById('next-rank-info').innerText = lvls < 100 ? `${currentRank.max - lvls} levels to next rank` : "MAX RANK ACHIEVED";
        }

        function renderShop() {
            const grid = document.getElementById('skin-grid');
            grid.innerHTML = '';
            const brains = parseInt(localStorage.getItem('bt_coins')) || 0;
            const currentSkin = localStorage.getItem('bt_current_skin') || 'red';
            const purchased = JSON.parse(localStorage.getItem('bt_skins_owned')) || ['red'];

            skins.forEach(s => {
                const isOwned = purchased.includes(s.id);
                const el = document.createElement('div');
                el.className = `skin-item ${currentSkin === s.id ? 'active' : ''}`;
                el.style.opacity = isOwned ? "1" : "0.6";
                el.innerHTML = `
                    <div class="swatch" style="background: ${s.color}"></div>
                    <div style="font-weight:bold">${s.id.toUpperCase()}</div>
                    <div>${isOwned ? 'OWNED' : s.cost + ' ðŸ§ '}</div>
                `;
                el.onclick = () => {
                    if(isOwned) {
                        localStorage.setItem('bt_current_skin', s.id);
                        updateUI();
                    } else if(brains >= s.cost) {
                        localStorage.setItem('bt_coins', brains - s.cost);
                        purchased.push(s.id);
                        localStorage.setItem('bt_skins_owned', JSON.stringify(purchased));
                        localStorage.setItem('bt_current_skin', s.id);
                        updateUI();
                    }
                };
                grid.appendChild(el);
            });
        }

        function toggleMode() {
            const next = (localStorage.getItem('bt_mode') || 'dark') === 'dark' ? 'light' : 'dark';
            localStorage.setItem('bt_mode', next);
            document.documentElement.setAttribute('data-theme', next);
        }

        document.documentElement.setAttribute('data-theme', localStorage.getItem('bt_mode') || 'dark');
        window.onload = updateUI;
    </script>
</body>
</html>
