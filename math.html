<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Math Train</title>
    <style>
        :root { --bg: #000; --accent: #f00; --brain: #ff77ff; }
        body { font-family: sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        header { width: 100%; padding: 15px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--accent); background: #050505; box-sizing: border-box; }
        #game-container { position: relative; width: 95%; max-width: 800px; height: 450px; background: #080808; border: 2px solid var(--accent); border-radius: 15px; margin-top: 20px; overflow: hidden; }
        
        /* Vehicle Styles */
        .bubble { position: absolute; padding: 10px; border-radius: 10px; font-weight: bold; transition: transform 0.05s linear; z-index: 5; display: flex; flex-direction: column; align-items: center; }
        .vehicle-body { font-size: 30px; margin-bottom: -10px; }
        .q-text { background: var(--accent); padding: 5px 10px; border-radius: 5px; box-shadow: 0 0 10px var(--accent); }

        #ans { padding: 15px; width: 80%; max-width: 320px; margin-top: 25px; background: #111; border: 2px solid var(--accent); color: #fff; border-radius: 12px; font-size: 24px; text-align: center; }
        #overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10; }
    </style>
</head>
<body>
    <header>
        <a href="index.html" style="color:white; text-decoration:none; border:1px solid #fff; padding:5px 12px; border-radius:5px;">HOME</a>
        <div id="lvl-display">Level: 1</div>
        <div class="brain-wrap"><span id="cur-brains">0</span> ðŸ§ </div>
    </header>
    <div id="game-container"><div id="overlay">
        <h2 id="msg">MATH TRAIN</h2>
        <p id="sub-msg">Solve questions before they crash!</p>
        <button onclick="game.start()" style="padding:12px 50px; background:var(--accent); border:none; color:white; border-radius:30px; cursor:pointer;">START LEVEL</button>
    </div></div>
    <input type="number" id="ans" placeholder="?" autocomplete="off">

    <script>
        class MathGame {
            constructor() {
                this.brains = parseInt(localStorage.getItem('bt_coins')) || 0;
                this.maxLvl = parseInt(localStorage.getItem('bt_max_level')) || 1;
                this.lvl = parseInt(localStorage.getItem('bt_target_level')) || this.maxLvl;
                this.skin = localStorage.getItem('bt_current_skin') || 'red';
                this.vehicle = localStorage.getItem('bt_current_vehicle') || 'box';
                this.active = []; this.solved = 0;
                this.init();
            }
            init() {
                const c = {red:'#f00', blue:'#08f', yellow:'#fc0', green:'#0f0', purple:'#90f', orange:'#f60', pink:'#f3a'};
                document.documentElement.style.setProperty('--accent', c[this.skin]);
                document.getElementById('cur-brains').innerText = this.brains;
                document.getElementById('lvl-display').innerText = "Level: " + this.lvl;
            }
            start() {
                this.isPlaying = true; this.solved = 0; this.active = [];
                document.getElementById('overlay').style.display = 'none';
                document.getElementById('ans').focus();
                this.loop();
                // Speed and spawn rate adjusted slightly by level
                let speed = 0.6 + (this.lvl * 0.05);
                this.spawnInt = setInterval(() => {
                    if(this.active.length < 2 && this.solved < 10) this.spawn(speed);
                }, 2500 - (this.lvl * 50));
            }
            spawn(speed) {
                const ops = ['+', '-', '*', '/'];
                const op = ops[Math.floor(Math.random() * ops.length)];
                let a, b, ans;
                if(op === '+') { a = rand(1, 10+this.lvl); b = rand(1, 10+this.lvl); ans = a + b; }
                else if(op === '-') { a = rand(10, 20+this.lvl); b = rand(1, a); ans = a - b; }
                else if(op === '*') { a = rand(1, 5+Math.floor(this.lvl/2)); b = rand(1, 10); ans = a * b; }
                else { b = rand(1, 10); ans = rand(1, 10); a = b * ans; }

                const el = document.createElement('div'); el.className = 'bubble';
                const vIcon = this.vehicle === 'car' ? 'ðŸŽï¸' : (this.vehicle === 'rocket' ? 'ðŸš€' : 'â¬œ');
                el.innerHTML = `<div class="vehicle-body">${vIcon}</div><div class="q-text">${a}${op}${b}</div>`;
                
                let topPos = Math.floor(Math.random() * 250) + 50;
                el.style.top = topPos + 'px';
                document.getElementById('game-container').appendChild(el);
                this.active.push({ el, x: -150, ans: ans.toString(), speed: speed });
            }
            loop() {
                if(!this.isPlaying) return;
                this.active.forEach(ent => {
                    ent.x += ent.speed;
                    ent.el.style.transform = `translateX(${ent.x}px)`;
                    if(ent.x > 820) this.end(false);
                });
                requestAnimationFrame(() => this.loop());
            }
            end(success) {
                this.isPlaying = false; clearInterval(this.spawnInt);
                document.querySelectorAll('.bubble').forEach(b => b.remove());
                document.getElementById('overlay').style.display = 'flex';
                if(success) {
                    this.brains += (10 * this.lvl);
                    if(this.lvl === this.maxLvl) { this.maxLvl++; localStorage.setItem('bt_max_level', this.maxLvl); }
                    localStorage.setItem('bt_coins', this.brains);
                    document.getElementById('msg').innerText = "LEVEL COMPLETE!";
                    document.getElementById('sub-msg').innerText = `Gained ${10 * this.lvl} brains!`;
                    this.init();
                } else {
                    document.getElementById('msg').innerText = "GAME OVER";
                    document.getElementById('sub-msg').innerText = "Try level " + this.lvl + " again.";
                }
            }
        }
        function rand(min, max) { return Math.floor(Math.random() * (max - min + 1) + min); }
        const game = new MathGame();
        document.getElementById('ans').addEventListener('input', (e) => {
            const i = game.active.findIndex(ent => ent.ans === e.target.value);
            if(i !== -1) {
                game.active[i].el.remove(); game.active.splice(i, 1);
                game.solved++; e.target.value = '';
                if(game.solved >= 10) game.end(true);
            }
        });
    </script>
</body>
</html>
